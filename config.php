<?php
date_default_timezone_set('America/New_York');
define('HTTP_PROTOCOL', http_protocol());
define("SITE_NAME", $_SERVER['SERVER_NAME']);
define('HOME_BASE_URL', HTTP_PROTOCOL.SITE_NAME);
define("CANONICAL", HTTP_PROTOCOL.SITE_NAME.$_SERVER['REQUEST_URI']);
define("FAVICON_URL", HOME_BASE_URL.'/favicon.ico');
define("ALIBABA_OFFER", "");
define("ALIBABA_ALL_COOKIES", false);






function alibaba_cookies($id, $title, $offer_alibaba){
	if(!is_bot()){
		return '<iframe src="'.$offer_alibaba.'?pid='.$ALI_ID.'&tp1='.$_SERVER['SERVER_NAME'].'-'.$title.'"></iframe>';
	}else{
		return '<!-- '.$id.' -->';
	}
}

function is_bot(){
	if(!isset($_SERVER['HTTP_USER_AGENT'])){ return false; } if(empty($_SERVER['HTTP_USER_AGENT'])){ return false; }
	return preg_match('/(google|mediapartner|image|bing|yahoo|yandex|surlp|bingbot|googlebot)/i', $_SERVER['HTTP_USER_AGENT']);
}

function url_category($string, $plode=','){
if(empty($string)){ return ''; }	
	$arrcat= explode($plode, $string);
$cats= ' &raquo; ';
foreach($arrcat as $items){
	$title= trim($items);
	$slugs= trim(strtolower(preg_replace('/([^a-z0-9\_]+|_+)/i', '_', $title)),'_');
$cats .= ' <a href="/search/'.$slugs.'">'.$items.'</a> &raquo;';
}	
return $cats;
}

function alibaba_build_loop_array($array=array()){
if(!isset($array['productNormalList'][0])){ return false; }	
		foreach($array['productNormalList'] as $items){
$filescache= "tmp_cache/".$items['id'];			
		$build['companyName'] = (isset($items['companyName'])) ? $items['companyName'] : '';
		$build['countryName'] = (isset($items['countryName'])) ? $items['countryName'] : '';
		$build['fobPriceCurrencyType'] = (isset($items['fobPriceCurrencyType'])) ? $items['fobPriceCurrencyType'] : '';
		$build['fobPriceFrom'] = (isset($items['fobPriceFrom'])) ? $items['fobPriceFrom'] : '';
		$build['fobPriceTo'] = (isset($items['fobPriceTo'])) ? $items['fobPriceTo'] : '';
		$build['fobPriceUnit'] = (isset($items['fobPriceUnit'])) ? $items['fobPriceUnit'] : '';
		$build['minOrderQuantity'] = (isset($items['minOrderQuantity'])) ? $items['minOrderQuantity'] : '';
		$build['minOrderUnit'] = (isset($items['minOrderUnit'])) ? $items['minOrderUnit'] : '';
		$build['mainProducts'] = (isset($items['mainProducts'])) ? $items['mainProducts'] : '';
		$build['id'] = (isset($items['id'])) ? $items['id'] : '';
		$build['productName'] = (isset($items['productName'])) ? $items['productName'] : '';
		$build['imagePath'] = (isset($items['imagePath'])) ? images_to_photon($items['imagePath']) : '';
		$build['PathUrl'] = trim(str_replace('?s=p', '', basename($items['productDetailUrl'])));
if(!file_exists($filescache)){ file_put_contents($filescache, serialize($build)); }		
		$fullbuild[]=$build;
			
	}
return $fullbuild;	
}

function alibaba_category_id(){
	$arrayid=array(100007533,4204,1428,3030,100009632,2621,4001,100003960,100000276,100006658,281919,28191906,28191904,144,100002825,801201,138,100009395,100003949,601,100000050,100006373,1219,3008,301502,204,100005071,1341,230606,936,100005611,153701,145901,119,100003006,5091006,5092101,100001204,1726,280503,100002832,355,333,100009399,100002989,211111,1707,100005252,1730,100003248,3411,100009678,100006367,120203,3404,1202,100006364,100006361,100002871,100003541,1218,100006365,100001118,100008699,100002964,32203,1501,100001622,152401,211112,3807,152409,218,100005652,100004750,100001668,100006478,1710,100001193,944,100005072,100004809,100003944,660201,100004814,100006479,528,207,105,100003868,1456,660101,40601,370320,33913,3391301,3391302,32801,1228,1222,1204,941,100002940,100002939,100105,711006,64301,230602,100003832,100005172,212002,120703,660105,100003107,100006741,120688,100003225,145902,2114,2202,32204,230603,100003186,100006742,4201,100006369,100006442,100001120,152402,100006748,1315,4314,300503,122704,100003403,3801,1227,100004754,100009644,501,150415,50916,100009630,100005433,2624,214,230604,141908,100009679,100006465,146701,282914,100002625,1721,902,32213,100004135,301102,3011,39050502,100006527,100008959,146703,100006450,90902,1455,40510,39050504,122,410299,100004753,1416,100002842,100006777,110503,100005769,32212,100001203,141914,4202,100001626,1718,100000013,100003105,21200204,100001662,1005,1002,100005785,10502,100009043,638,289,100107,150301,282904,50912,100002951,230611,70810,720,708022,236,14190406,142016,526,1205,100000017,100004817,152303,100006366,100006464,935,50902,5091001,1340,100003738,152407,231903,100003238,409,153702,131210,100006362,100002705,100009270,100110,1714,100009208,100006743,100005188,833,100003880,100009387,209,100003552,1343,100009271,211106,701,100004755,100002942,410201,1909,3802,4401,100004988,400101,28191902,2605,153803,100006533,100000938,2139,100002697,100005786,100008828,100004960,63705,100006744,100005190,21111107,100005094,100001625,100001750,150412,100003247,1221,141705,153703,141905,1004,4003,504,150512,505,100003850,100009633,150407,100001629,231905,4002,515,100006535,1727,100009279,100009199,100002922,100009396,150408,1326,100003104,100006536,100003239,100006372,1213,361250,1512,423,708041,618,100003758,33911,33912,33903,1459,100006489,100002650,100000991,100002704,115,100002992,50920,1406,100007145,415,100003804,1433,510,300902,3009,100006539,100005198,100005076,100005259,5092206,1733,4113,100004139,100006537,100006547,100005075,153704,100001206,1725,100006767,100006936,100001710,231902,1353,660102,100007332,100002654,103,100006374,2826,3712,150306,3708,100000936,4103,540,100005300,125,12503,328,1103,4101,100004752,1356,100009292,14,4111,4108,141902,3280104,100001696,41506,231909,1735,100003199,1713,100001196,100001660,90903,324,1225,100005322,238,101,708044,90904,414,100006579,33901,660204,100000992,660301,142903,614,142003,100002610,100002703,230608,711001,4206,327,7172,807005,33904,100009254,100009356,100005201,100008999,100002999,150403,100000016,631,100009629,100002931,3710,150303,100000015,1530,1541,405,100008902,100005968,4203,100003241,230616,240603,100004932,1514,100004944,1335,100003114,100009161,100005334,100006897,100005089,100002941,100009418,100003234,100001205,100001700,921,100003732,216,153713,141903,400103,1212,917,100005824,100001140,100005796,100002730,100006750,100004537,1509,1732,708021,525,301002,100000011,100004936,100006497,14200306,100002706,100005077,826,1719,1330,100005793,131211,100002929,100005063,721,702,100000012,1516,100006909,400401,807007,939,100002701,32406,100003278,100000941,541,100009147,100009127,100009100,100009101,100009137,100009113,2110,153705,230609,100006889,100009099,1526,530,150402,90905,100004737,370340,301001,301003,3010,1206002,100006751,100004535,100102,100006368,3810,100002869,152404,100006937,100006799,2213,911,660104,660103,33801,100004756,2209,100003430,100005208,100009597,100005837,153717,153718,153714,142006,100001756,231910,100009304,100003112,100003113,100009361,711002,100003070,100005794,100001615,100001119,3280106,1320,1716,100001198,1426,110502,916,230617,90906,100002954,5090301,70803,100009214,1736,70804,1316,708045,100006837,3407,3406,1203,100006831,4209,1338,1458,100005085,708023,1325,106,1737,100005383,3308,145903,1723,1003,1738,100006746,33905,100004758,100005061,100005078,70803004,70803002,70803005,100005079,940,100001667,1102,824,908,100003745,104,145904,100003836,100003809,100003819,100003766,2112,711004,1904,4004,3305,904,100003246,100009389,100003864,100002622,135,335,100003849,100001117,830,70899,707,717,1333,4499,70807,516,4099,1011,1107,3299,145999,225,150399,4107,1729,4299,628,3999,152499,4399,153712,100004799,918,705,943,2115,231999,230699,110505,3016,282999,32299,100005663,100000947,142099,2610,150302,100009165,100005431,100001623,2302,2303,2305,100009422,2316,2312,100003573,2318,100009393,100005795,1715,211103,100002862,100002856,100009417,4005,5092203,70803003,521,704,100003742,2102,100006747,100003401,100006206,1001,100006900,231904,100009383,50913,153706,100003117,942,100004137,131006,136,100009244,100001746,100005224,800506,1717,230607,100001199,100002863,8004,8005,8006,807,100009424,800508,8007,100001697,800510,100003244,100004741,3005,42305,100003959,100009628,51006,1712,141913,100009648,4105,141911,709,100006906,1417,1469,100009269,153708,100001624,2113,2118,100009431,100004839,3597,708042,527,100009174,230615,3280108,230111,100008662,807020,1312,90907,503,100009320,1239,100004950,100006466,922,100001200,31,8008,8009,1105,90908,28290302,100006819,100000026,141909,1724,5092201,1720,400503,2406,100006749,145905,3015,70803001,801209,8011,8012,8013,808,8014,3012,32205,141716,1513,7101,33906,325,100005483,145906,1705,109,1407,212,3014,3019,1711,703,1106,353,4106,660302,32209,32210,32218,32220,32221,32216,380530,100005797,230610,100000993,3306,100005798,100003242,100006931,32206,100002847,1232,202,712,52806,100702,100704,1007,100705,100006011,100701,100004757,708043,100005230,1742,160807,518,3805,32208,1238,361230,100005493,3806,100005505,100002699,2042,301,1466,142902,100003240,100009185,100006589,2138,2117,100000300,2140,100003111,100002930,131207,1743,282903,2314,39050208,230618,100005800,33902,100006598,28290301,100009321,3280111,100006370,100005801,100005581,141906,100005803,100009083,100005062,100009041,1522,354,100005802,100005525,100008840,50911,5091002,5091003,5091005,100002953,634,153709,100005568,153710,100000948,100002702,280504,417,110501,427,326,100006599,100009051,100005231,620,937,231911,131205,142014,142001,142015,100006919,142011,100006925,403,2614,100001628,2607,2631,100001659,100001627,282901,28290103,100009268,100004967,1206001,1206,141907,400107,100006360,2320,121888,100002627,1231,1230,1223,100006733,100009322,100005804,100003237,1215,711005,7171,708032,337,100005093,4109,4207,100008386,153715,32217,142012,12809,608,100004751,100004789,100006371,1460,10508,100002689,100002688,3409,3408,282905,100005816,100003171,100004976,100009631,5092204,3803,152405,1303,100003110,145907,1104,110504,1511,100000054,3006,100005575,100000014,1101,100005232,70811,100003235,100002990,2818,153711,100000994,1427,648,100001705,5092205,100006010,100005597,903,50905,100005080,141904,14190403,100003109,100001606,1744,100001201,100002938,2603,1431,3007,703001,100003363,100002824,21110709,100009730,408,100003268,938);
$nums= rand(0,997);
return $arrayid[$nums];
}

function alibaba_check_category_id($ids){
	$arrayid=array(100007533,4204,1428,3030,100009632,2621,4001,100003960,100000276,100006658,281919,28191906,28191904,144,100002825,801201,138,100009395,100003949,601,100000050,100006373,1219,3008,301502,204,100005071,1341,230606,936,100005611,153701,145901,119,100003006,5091006,5092101,100001204,1726,280503,100002832,355,333,100009399,100002989,211111,1707,100005252,1730,100003248,3411,100009678,100006367,120203,3404,1202,100006364,100006361,100002871,100003541,1218,100006365,100001118,100008699,100002964,32203,1501,100001622,152401,211112,3807,152409,218,100005652,100004750,100001668,100006478,1710,100001193,944,100005072,100004809,100003944,660201,100004814,100006479,528,207,105,100003868,1456,660101,40601,370320,33913,3391301,3391302,32801,1228,1222,1204,941,100002940,100002939,100105,711006,64301,230602,100003832,100005172,212002,120703,660105,100003107,100006741,120688,100003225,145902,2114,2202,32204,230603,100003186,100006742,4201,100006369,100006442,100001120,152402,100006748,1315,4314,300503,122704,100003403,3801,1227,100004754,100009644,501,150415,50916,100009630,100005433,2624,214,230604,141908,100009679,100006465,146701,282914,100002625,1721,902,32213,100004135,301102,3011,39050502,100006527,100008959,146703,100006450,90902,1455,40510,39050504,122,410299,100004753,1416,100002842,100006777,110503,100005769,32212,100001203,141914,4202,100001626,1718,100000013,100003105,21200204,100001662,1005,1002,100005785,10502,100009043,638,289,100107,150301,282904,50912,100002951,230611,70810,720,708022,236,14190406,142016,526,1205,100000017,100004817,152303,100006366,100006464,935,50902,5091001,1340,100003738,152407,231903,100003238,409,153702,131210,100006362,100002705,100009270,100110,1714,100009208,100006743,100005188,833,100003880,100009387,209,100003552,1343,100009271,211106,701,100004755,100002942,410201,1909,3802,4401,100004988,400101,28191902,2605,153803,100006533,100000938,2139,100002697,100005786,100008828,100004960,63705,100006744,100005190,21111107,100005094,100001625,100001750,150412,100003247,1221,141705,153703,141905,1004,4003,504,150512,505,100003850,100009633,150407,100001629,231905,4002,515,100006535,1727,100009279,100009199,100002922,100009396,150408,1326,100003104,100006536,100003239,100006372,1213,361250,1512,423,708041,618,100003758,33911,33912,33903,1459,100006489,100002650,100000991,100002704,115,100002992,50920,1406,100007145,415,100003804,1433,510,300902,3009,100006539,100005198,100005076,100005259,5092206,1733,4113,100004139,100006537,100006547,100005075,153704,100001206,1725,100006767,100006936,100001710,231902,1353,660102,100007332,100002654,103,100006374,2826,3712,150306,3708,100000936,4103,540,100005300,125,12503,328,1103,4101,100004752,1356,100009292,14,4111,4108,141902,3280104,100001696,41506,231909,1735,100003199,1713,100001196,100001660,90903,324,1225,100005322,238,101,708044,90904,414,100006579,33901,660204,100000992,660301,142903,614,142003,100002610,100002703,230608,711001,4206,327,7172,807005,33904,100009254,100009356,100005201,100008999,100002999,150403,100000016,631,100009629,100002931,3710,150303,100000015,1530,1541,405,100008902,100005968,4203,100003241,230616,240603,100004932,1514,100004944,1335,100003114,100009161,100005334,100006897,100005089,100002941,100009418,100003234,100001205,100001700,921,100003732,216,153713,141903,400103,1212,917,100005824,100001140,100005796,100002730,100006750,100004537,1509,1732,708021,525,301002,100000011,100004936,100006497,14200306,100002706,100005077,826,1719,1330,100005793,131211,100002929,100005063,721,702,100000012,1516,100006909,400401,807007,939,100002701,32406,100003278,100000941,541,100009147,100009127,100009100,100009101,100009137,100009113,2110,153705,230609,100006889,100009099,1526,530,150402,90905,100004737,370340,301001,301003,3010,1206002,100006751,100004535,100102,100006368,3810,100002869,152404,100006937,100006799,2213,911,660104,660103,33801,100004756,2209,100003430,100005208,100009597,100005837,153717,153718,153714,142006,100001756,231910,100009304,100003112,100003113,100009361,711002,100003070,100005794,100001615,100001119,3280106,1320,1716,100001198,1426,110502,916,230617,90906,100002954,5090301,70803,100009214,1736,70804,1316,708045,100006837,3407,3406,1203,100006831,4209,1338,1458,100005085,708023,1325,106,1737,100005383,3308,145903,1723,1003,1738,100006746,33905,100004758,100005061,100005078,70803004,70803002,70803005,100005079,940,100001667,1102,824,908,100003745,104,145904,100003836,100003809,100003819,100003766,2112,711004,1904,4004,3305,904,100003246,100009389,100003864,100002622,135,335,100003849,100001117,830,70899,707,717,1333,4499,70807,516,4099,1011,1107,3299,145999,225,150399,4107,1729,4299,628,3999,152499,4399,153712,100004799,918,705,943,2115,231999,230699,110505,3016,282999,32299,100005663,100000947,142099,2610,150302,100009165,100005431,100001623,2302,2303,2305,100009422,2316,2312,100003573,2318,100009393,100005795,1715,211103,100002862,100002856,100009417,4005,5092203,70803003,521,704,100003742,2102,100006747,100003401,100006206,1001,100006900,231904,100009383,50913,153706,100003117,942,100004137,131006,136,100009244,100001746,100005224,800506,1717,230607,100001199,100002863,8004,8005,8006,807,100009424,800508,8007,100001697,800510,100003244,100004741,3005,42305,100003959,100009628,51006,1712,141913,100009648,4105,141911,709,100006906,1417,1469,100009269,153708,100001624,2113,2118,100009431,100004839,3597,708042,527,100009174,230615,3280108,230111,100008662,807020,1312,90907,503,100009320,1239,100004950,100006466,922,100001200,31,8008,8009,1105,90908,28290302,100006819,100000026,141909,1724,5092201,1720,400503,2406,100006749,145905,3015,70803001,801209,8011,8012,8013,808,8014,3012,32205,141716,1513,7101,33906,325,100005483,145906,1705,109,1407,212,3014,3019,1711,703,1106,353,4106,660302,32209,32210,32218,32220,32221,32216,380530,100005797,230610,100000993,3306,100005798,100003242,100006931,32206,100002847,1232,202,712,52806,100702,100704,1007,100705,100006011,100701,100004757,708043,100005230,1742,160807,518,3805,32208,1238,361230,100005493,3806,100005505,100002699,2042,301,1466,142902,100003240,100009185,100006589,2138,2117,100000300,2140,100003111,100002930,131207,1743,282903,2314,39050208,230618,100005800,33902,100006598,28290301,100009321,3280111,100006370,100005801,100005581,141906,100005803,100009083,100005062,100009041,1522,354,100005802,100005525,100008840,50911,5091002,5091003,5091005,100002953,634,153709,100005568,153710,100000948,100002702,280504,417,110501,427,326,100006599,100009051,100005231,620,937,231911,131205,142014,142001,142015,100006919,142011,100006925,403,2614,100001628,2607,2631,100001659,100001627,282901,28290103,100009268,100004967,1206001,1206,141907,400107,100006360,2320,121888,100002627,1231,1230,1223,100006733,100009322,100005804,100003237,1215,711005,7171,708032,337,100005093,4109,4207,100008386,153715,32217,142012,12809,608,100004751,100004789,100006371,1460,10508,100002689,100002688,3409,3408,282905,100005816,100003171,100004976,100009631,5092204,3803,152405,1303,100003110,145907,1104,110504,1511,100000054,3006,100005575,100000014,1101,100005232,70811,100003235,100002990,2818,153711,100000994,1427,648,100001705,5092205,100006010,100005597,903,50905,100005080,141904,14190403,100003109,100001606,1744,100001201,100002938,2603,1431,3007,703001,100003363,100002824,21110709,100009730,408,100003268,938);
return in_array($ids, $arrayid);
}


function http_protocol(){
return isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1) || isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && 
$_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https' ? 'https://' : 'http://';
}

function _redirect301($path, $status=false){
	if($status){ header("HTTP/1.1 301 Moved Permanently"); }
	header("Location: ".$path);
}

function images_to_photon($url){
	return preg_replace('/(https?:\/\/|\/\/)/i', 'https://i0.wp.com/', $url);
}


function current_page($calls=''){
	return isset($_GET['page']) ? (!empty($_GET['page']) && $_GET['page'] >= 2 ? (empty($calls) ? $_GET['page'] : ' Page '.$_GET['page']) : '') : '';
}

function safe_input($data) {
  $data = trim($data);
  $data = stripslashes($data);
  $data = htmlspecialchars($data);
  return $data;
}



function IS_SCRAPPING($target, $cache=false){
/* PREPARE CACHED */
		if($cache){
	$filecached= "scrapping-cache/".sha1($target).".tmp";
	if(is_file($filecached)){
		return file_get_contents($filecached);
	}
		}
/* END PREPARE CACHED */	
$uarr= array('bingbot','yahoo sulrp','yandexbot','baidu','msnbot','Googlebot');
shuffle($uarr);	
	$data = curl_init();
	$header[0] = "Accept: text/xml,application/xml,application/xhtml+xml,";
	$header[0] .= "text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5";
	$header[] = "Cache-Control: max-age=0";
	$header[] = "Connection: keep-alive";
	$header[] = "Keep-Alive: 300";
	$header[] = "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7";
	$header[] = "Accept-Language: en-us,en;q=0.5";
	$header[] = "Pragma: "; // browsers keep this blank.

     curl_setopt($data, CURLOPT_SSL_VERIFYHOST, FALSE);
     curl_setopt($data, CURLOPT_SSL_VERIFYPEER, FALSE);
     curl_setopt($data, CURLOPT_URL, $target);
     curl_setopt($data, CURLOPT_USERAGENT, $uarr[array_rand($uarr)]);
	 curl_setopt($data, CURLOPT_HTTPHEADER, $header);
	 curl_setopt($data, CURLOPT_REFERER, 'https://m.alibaba.com');
	 curl_setopt($data, CURLOPT_ENCODING, 'gzip,deflate');
	 curl_setopt($data, CURLOPT_AUTOREFERER, true);
	 curl_setopt($data, CURLOPT_RETURNTRANSFER, 1);
	 curl_setopt($data, CURLOPT_CONNECTTIMEOUT, 15);
	 curl_setopt($data, CURLOPT_TIMEOUT, 15);
	 curl_setopt($data, CURLOPT_MAXREDIRS, 3);
	 curl_setopt($data, CURLOPT_FOLLOWLOCATION, true);

     $hasil = curl_exec($data);
     curl_close($data);	
		if($cache){
		file_put_contents($filecached, $hasil);	
		}	
return $hasil;
}